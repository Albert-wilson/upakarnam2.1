<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Topper Falls â€” Backbenchers Rise! ðŸŽ“</title>
<style>
  :root{--bg:#071120;--card:#0b1b2a;--accent:#ffd35b;--good:#7ef59f;--bad:#ff6b6b;--muted:#9fb6c9}
  body{margin:0;min-height:100vh;background:radial-gradient(circle at 10% 10%, #092034 0%, var(--bg) 45%);font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#eaf6ff;display:flex;align-items:center;justify-content:center;padding:24px}
  .wrap{width:980px;max-width:96%}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .controls{display:flex;gap:8px;align-items:center}
  input[type="number"]{width:72px;padding:6px;border-radius:8px;border:none;background:#07202f;color:#dff3fb}
  button{background:var(--accent);border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;color:#062027;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
  .card{background:linear-gradient(180deg,var(--card), rgba(8,20,30,0.9));padding:12px;border-radius:12px;box-shadow:0 8px 32px rgba(2,6,20,0.6);margin-bottom:12px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:12px}
  .roster{max-height:420px;overflow:auto}
  .student{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:6px;background:linear-gradient(90deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.03)}
  .name{font-weight:700}
  .score{font-size:16px}
  .muted{color:var(--muted);font-size:13px}
  .highlight-good{background:linear-gradient(90deg, rgba(126,245,159,0.08), transparent);border-color:rgba(126,245,159,0.12)}
  .highlight-bad{background:linear-gradient(90deg, rgba(255,107,107,0.06), transparent);border-color:rgba(255,107,107,0.12)}
  .side{display:flex;flex-direction:column;gap:8px}
  .bar{height:10px;border-radius:8px;background:linear-gradient(90deg,#133544,#0b2a35);overflow:hidden}
  .bar-inner{height:100%;border-radius:8px}
  .confetti{position:absolute;pointer-events:none}
  footer{display:flex;justify-content:space-between;align-items:center;margin-top:6px;color:var(--muted);font-size:13px}
  .small{font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Topper Falls â€” Backbenchers Rise! ðŸŽ“</h1>
    <div class="controls">
      <label class="muted small">Class size</label>
      <input id="classSize" type="number" min="5" max="40" value="12">
      <label class="muted small">Backbenchers to boost</label>
      <input id="boostCount" type="number" min="1" max="8" value="3">
      <button id="start">Start Drama</button>
      <button id="reset" style="background:#88cfff;color:#01223a">Reset</button>
    </div>
  </header>

  <div class="grid">
    <div class="card roster" id="roster">
      <!-- roster list -->
    </div>

    <div class="side">
      <div class="card">
        <strong>Current Leaderboard</strong>
        <div id="leaderboard" style="margin-top:8px"></div>
      </div>

      <div class="card">
        <strong>Controls & Info</strong>
        <p class="muted">Simulation steps: Topper loses marks dramatically; randomly selected backbenchers get improved marks and the class is re-ranked. Download the final leaderboard if you want.</p>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="download" style="background:#8be28b">Download JSON</button>
          <button id="step" class="" style="background:#ffd35b">Step</button>
        </div>
      </div>

      <div class="card">
        <strong>Outcome</strong>
        <div id="outcome" style="margin-top:8px" class="muted">No simulation yet.</div>
        <div style="margin-top:8px" class="muted small">Tips: Increase boost count to create more surprises.</div>
      </div>
    </div>
  </div>

  <footer>
    <div class="muted">Made for dramatic classroom chaos â€” harmless & simulated.</div>
    <div class="muted">Enjoy the chaos!</div>
  </footer>
</div>

<canvas id="confetti" class="confetti" width="1200" height="800" style="left:0;top:0;"></canvas>

<script>
/* Topper Falls simulation
   - Generates students with initial scores
   - Finds current topper(s)
   - Performs a "topper fails" event (topper score drops)
   - Boosts several random backbenchers by increasing their scores
   - Re-sorts and animates highlights
*/

const rosterEl = document.getElementById('roster');
const leaderboardEl = document.getElementById('leaderboard');
const startBtn = document.getElementById('start');
const resetBtn = document.getElementById('reset');
const classSizeInput = document.getElementById('classSize');
const boostCountInput = document.getElementById('boostCount');
const downloadBtn = document.getElementById('download');
const stepBtn = document.getElementById('step');
const outcomeEl = document.getElementById('outcome');

let students = [];
let stepState = 0; // 0 = initial, 1 = topper failed, 2 = backbenchers boosted, 3 = final
let lastTopperIds = [];
let boostedIds = [];

function randName(i){
  const names = ["Aman","Riya","Siddh","Neha","Vikram","Priya","Rahul","Kavya","Sameer","Isha","Arjun","Meera","Rana","Tara","Kabir","Zoya","Ishaan","Nita","Fayz","Ayesha","Dev","Rohan","Maya","Nikhil","Simran","Karan","Anya","Vikrant","Sana","Esha"];
  return names[i % names.length] + (Math.floor(Math.random()*90)+10);
}

function initClass(n=12){
  students = [];
  for(let i=0;i<n;i++){
    // backbenchers often have lower avg â€” but randomize a bit
    const base = 40 + Math.random()*40; // 40..80
    // sprinkle a few high scorers
    const bonus = (Math.random() < 0.12) ? (5 + Math.random()*15) : 0;
    const score = Math.round(Math.min(100, base + bonus));
    students.push({id: 's'+i, name: randName(i), score});
  }
  // ensure there is at least one clear topper
  students[0].score = Math.max(students[0].score, 92);
  students[1].score = Math.max(students[1].score, 88);
  sortStudents();
  renderAll();
  stepState = 0;
  outcomeEl.textContent = "Ready. Click Start Drama to make the topper fail and watch backbenchers rise!";
  lastTopperIds = [];
  boostedIds = [];
}

/* sort descending by score, tie-breaker by name */
function sortStudents(){ students.sort((a,b)=> b.score - a.score || a.name.localeCompare(b.name)); }

function renderRoster(){
  rosterEl.innerHTML = '';
  students.forEach((s, idx) => {
    const div = document.createElement('div');
    div.className = 'student';
    div.id = s.id;
    let medal = idx===0 ? 'ðŸ¥‡ ' : idx===1 ? 'ðŸ¥ˆ ' : idx===2 ? 'ðŸ¥‰ ' : '';
    div.innerHTML = `
      <div>
        <div class="name">${medal}${s.name}</div>
        <div class="muted small">Roll: ${idx+1}</div>
      </div>
      <div style="width:220px;text-align:right">
        <div class="score">${s.score} / 100</div>
        <div class="bar" style="margin-top:6px">
          <div class="bar-inner" style="width:${s.score}%;background:linear-gradient(90deg, #2bb673, #07a);"></div>
        </div>
      </div>
    `;
    rosterEl.appendChild(div);
  });
}

function renderLeaderboard(){
  leaderboardEl.innerHTML = '';
  const top5 = students.slice(0,5);
  top5.forEach((s, i) => {
    const el = document.createElement('div');
    el.style.display='flex';
    el.style.justifyContent='space-between';
    el.style.padding='6px 0';
    el.innerHTML = <div>${i+1}. ${s.name}</div><div class="muted">${s.score}</div>;
    leaderboardEl.appendChild(el);
  });
}

/* highlight helpers */
function addHighlight(id, cls){
  const el = document.getElementById(id);
  if(!el) return;
  el.classList.add(cls);
  setTimeout(()=> el.classList.remove(cls), 2400);
}

/* Simulation steps */
function doTopperFail(){
  // topper is current top student(s) with equal top score
  const topScore = students[0].score;
  const toppers = students.filter(s => s.score === topScore);
  lastTopperIds = toppers.map(t=>t.id);
  // toppers' scores crash by 20..40 points
  toppers.forEach(t => {
    const drop = 20 + Math.floor(Math.random()*21); // 20..40
    t.score = Math.max(0, t.score - drop);
    addHighlight(t.id, 'highlight-bad');
  });
  sortStudents();
  renderAll();
  outcomeEl.textContent = ${toppers.map(t=>t.name).join(', ')} (topper) had a dramatic fail! Scores dropped.;
}

function doBoostBackbenchers(k=3){
  // choose k random "backbenchers" from bottom half (not already toppers)
  const eligible = students.slice(Math.ceil(students.length/2)).filter(s => !lastTopperIds.includes(s.id));
  boostedIds = [];
  for(let i=0;i<k && eligible.length>0;i++){
    const idx = Math.floor(Math.random()*eligible.length);
    const s = eligible.splice(idx,1)[0];
    // boost by 15..35 points
    const inc = 15 + Math.floor(Math.random()*21);
    s.score = Math.min(100, s.score + inc);
    boostedIds.push(s.id);
    addHighlight(s.id, 'highlight-good');
  }
  sortStudents();
  renderAll();
  outcomeEl.textContent = Backbenchers (${boostedIds.length}) made sudden progress â€” they climbed the ranks!;
}

/* Run full drama with animations */
function runDrama(){
  if(stepState !== 0) return;
  stepState = 1;
  doTopperFail();
  // then after 1.1s boost some backbenchers
  setTimeout(()=> {
    stepState = 2;
    const k = Math.max(1, Math.min(students.length-3, Number(boostCountInput.value)||3));
    doBoostBackbenchers(k);
    // finalize after a short delay
    setTimeout(()=> {
      stepState = 3;
      renderAll();
      confettiBurst();
      outcomeEl.textContent += " Final leaderboard updated.";
    }, 900);
  }, 1100);
}

/* step-by-step control */
stepBtn.addEventListener('click', ()=>{
  if(stepState === 0) doTopperFail(), stepState = 1;
  else if(stepState === 1) doBoostBackbenchers(Math.max(1, Number(boostCountInput.value)||3)), stepState = 2;
  else if(stepState === 2) { /* finalize */ stepState = 3; confettiBurst(); outcomeEl.textContent = "Final leaderboard updated."; }
});

startBtn.addEventListener('click', runDrama);
resetBtn.addEventListener('click', ()=> initClass(Number(classSizeInput.value)||12));
downloadBtn.addEventListener('click', ()=>{
  const data = JSON.stringify(students, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'leaderboard.json';
  a.click();
  URL.revokeObjectURL(url);
});

/* confetti â€” small, simple effect */
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
let confettiPieces = [];

function ConfettiPiece(x,y,dx,dy,color){
  this.x=x;this.y=y;this.dx=dx;this.dy=dy;this.color=color;this.life=160+Math.random()*80;this.t=0;this.sz=6+Math.random()*8;
}
ConfettiPiece.prototype.update = function(){
  this.t++;
  this.x += this.dx; this.y += this.dy;
  this.dy += 0.15; // gravity
  this.dx *= 0.995;
  this.life--;
}
ConfettiPiece.prototype.draw = function(ctx){
  ctx.save();
  ctx.translate(this.x,this.y);
  ctx.rotate(this.t*0.06);
  ctx.fillStyle = this.color;
  ctx.fillRect(-this.sz/2, -this.sz/2, this.sz, this.sz*0.6);
  ctx.restore();
}

function confettiBurst(){
  const colors = ['#ffd35b','#ff6b6b','#7ef59f','#88cfff','#d7a6ff','#ffb5e8'];
  for(let i=0;i<80;i++){
    const x = window.innerWidth * (0.3 + Math.random()*0.4);
    const y = window.innerHeight * 0.15;
    const dx = (Math.random()-0.5)*6;
    const dy = -6 - Math.random()*6;
    confettiPieces.push(new ConfettiPiece(x,y,dx,dy,colors[Math.floor(Math.random()*colors.length)]));
  }
}

/* confetti loop */
function confettiLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  confettiPieces = confettiPieces.filter(p=>p.life>0 && p.y < canvas.height + 50);
  for(const p of confettiPieces){ p.update(); p.draw(ctx); }
  requestAnimationFrame(confettiLoop);
}
confettiLoop();

/* render combined */
function renderAll(){ renderRoster(); renderLeaderboard(); }

/* init */
initClass(Number(classSizeInput.value)||12);

/* responsiveness */
window.addEventListener('resize', ()=>{canvas.width = window.innerWidth; canvas.height = window.innerHeight;});
</script>
</body>
</html>
hi